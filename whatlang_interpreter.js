var u={"+":(e,n)=>e+n,"-":(e,n)=>e-n,"*":(e,n)=>e*n,"/":(e,n)=>e/n,"%":(e,n)=>e%n,"?":(e,n)=>e==n?0:+(e>n)-+(e<n)||NaN},h=e=>Array.isArray(e)?new RegExp(e[0],e[1]):e,d={num:e=>Number(e),str:e=>Array.isArray(e)&&e.every(n=>typeof n=="string"&&n.length==1)?e.join(""):p(e),repr:e=>g(e),arr:e=>[...e],pow:(e,n)=>e**n,sin:e=>Math.sin(e),cos:e=>Math.cos(e),tan:e=>Math.tan(e),asin:e=>Math.asin(e),acos:e=>Math.acos(e),atan:e=>Math.atan(e),band:(e,n)=>e&n,bor:(e,n)=>e|n,bxor:(e,n)=>e^n,bnot:e=>~e,rand:()=>Math.random(),randint:(e,n)=>Math.floor(Math.random()*(e-n)+n),flr:e=>Math.floor(e),range:e=>[...Array(e).keys()],len:e=>[...e.at(-1).at(-1)].length,split:(e,n)=>(typeof e=="string"?e:p(e)).split(n),join:(e,n)=>[...n.at(-1).at(-1)].map(y=>typeof y=="string"?y:p(y)).join(e),reverse:e=>[...e.at(-1).at(-1)].reverse(),in:(e,n)=>[...n.at(-1).at(-1)].indexOf(e),filter:async(e,n,y,l)=>(await[...n.at(-1).at(-1)].reduce(async(f,a)=>[...await f,[a,await o([...n.slice(0,-1),n.at(-1).concat([a,e])],y,l)]],[])).filter(f=>f[1]||Number.isNaN(f[1])).map(f=>f[0]),chr:e=>Array.isArray(e)?String.fromCodePoint(...e):String.fromCodePoint(e),ord:e=>[...typeof e=="string"?e:p(e)].map(n=>n.codePointAt(0)),and:(e,n)=>(Number.isNaN(e)||e)&&n,or:(e,n)=>Number.isNaN(e)?e:e||n,nan:()=>NaN,undef:e=>void e.at(-1).push(void 0),inf:()=>1/0,ninf:()=>-1/0,eq:(e,n)=>+(e===n),stak:e=>e.at(-1),stack:e=>[...e.at(-1)],try:async(e,n,y)=>{let l=[void 0,void 0];try{await o(e,n,y)}catch(f){l=[f.name,f.message]}return l},throw:e=>{throw new Error(e)},match:(e,n)=>[...e.match(h(n))||[]],repl:(e,n,y)=>e.replace(h(n),y),time:()=>Date.now(),type:e=>e==null?"Undefined":e.constructor.name},w="filter try".split(" "),b="len join reverse in stak stack undef".split(" "),p=e=>Array.isArray(e)?"["+e.map(n=>Array.isArray(n)&&n==e?"[...]":p(n)).join(", ")+"]":typeof e=="string"?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\t/g,"\\t")+'"':e==null?"undef":Number.isNaN(e)?"NaN":e==1/0?"Inf":e==-1/0?"-Inf":String(e),A=e=>{let n=0;for(let y of e)if(y==="("?n++:y===")"&&n--,n<0)return!1;return n===0},g=e=>Array.isArray(e)?"["+e.map(n=>Array.isArray(n)&&n==e?"stack@":g(n)).join(" ")+"]":typeof e=="string"?/^[a-zA-Z][a-zA-Z0-9_]*$/.test(e)?e:A(e)?"("+e+")":'"'+e.replace('"','\\"').replace(`
`,"\\n").replace("	","\\t")+'"':e===void 0?"undef@":Number.isNaN(e)?"nan@":e==1/0?"inf@":e==-1/0?"ninf@":typeof e=="number"?e<0||e>=1e21||!Number.isInteger(e)?"("+String(e)+")num@":String(e):"${"+String(e)+"}",o=async(e,n,y,{dead_loop_check:l=()=>{}}={})=>{var f=e.at(-1);let a,s,t;return a=f.pop(),a in n&&typeof n[a]=="function"?(t=w.includes(a)?3:b.includes(a)?1:0,a=n[a],s=[e,n,y],s.splice(t),s=(a.length>t?f.splice(t-a.length):[]).concat(s),a=await a(...s),a!=null&&f.push(a)):(s=a in n?n[a]:a,await m(s,e,n,y,{dead_loop_check:l})),f.at(-1)},v=async(e,n=d,{dead_loop_check:y=()=>{}}={})=>{let l="";return{stack:await m(e,[[]],Object.assign({},n),a=>{l+=a},{dead_loop_check:y}),output:l}},m=async(e,n,y,l,{dead_loop_check:f=()=>{}}={})=>{var a=n.at(-1);let s=-1,t,i,r;for(;++s<e.length;)if(f(),t=e[s],!/\s/.test(t)){if(/[1-9]/.test(t)){i=0;do i=i*10+Number(t),t=e[++s];while(t&&/\d/.test(t));t=e[--s],a.push(i)}else if(t==="0")a.push(0);else if(/[a-zA-Z]/.test(t)){i="";do i+=t,t=e[++s];while(t&&/[a-zA-Z0-9_]/.test(t));t=e[--s],a.push(i.toLowerCase())}else if(t==="'")a.push(t=e[++s]);else if(/["`]/.test(t)){for(i="",r=t,t=e[++s];t;){if(t==="\\")t=e[++s],i+={n:`
`,t:"	",[r]:r}[t]??t;else{if(r===t)break;i+=t}t=e[++s]}r==='"'?a.push(i):r==="`"&&l(i)}else if(t in u)i=a.pop(),a.push(u[t](a.pop(),i));else if(t==="~")i=a.pop(),a.push(Number.isNaN(i)?0:+!i);else if(t==="[")a=[],n.push(a);else if(t==="|")i=a.pop(),n.push(i),a=i;else if(t==="]")n.length<=2&&n.unshift([]),a=n.at(-2),a.push(n.pop());else if(t==="("){for(i="",r=1,t=e[++s];t==="("?++r:t===")"&&--r,!(!t||!r);)i+=t,t=e[++s];a.push(i)}else if(t===".")i=a.at(-1),l(typeof i=="string"?i:p(i));else if(t==="\\")a.length>=2&&(i=a.pop(),r=a.pop(),a.push(i,r));else if(t==="&")a.length>=2&&a.unshift(a.pop());else if(t===":")a.length>=1&&(i=a.pop(),a.push(i,i));else if(t==="_")a.pop();else if(t==="=")i=a.pop(),y[i]=a.at(-1);else if(t==="^")i=a.pop(),r=y[i],a.push(typeof r=="function"?i+"@":r);else if(t==="@")await o(n,y,l,{dead_loop_check:f}),a=n.at(-1);else if(t===">")a.push(a.splice(-a.pop()));else if(t==="<")a.push(...a.pop());else if(t==="{"){if(i=a.pop(),!(Number.isNaN(i)||i))for(i=1;t&&i;)t=e[++s],t==="{"?++i:t==="}"&&--i}else if(t==="}"){if(i=a.pop(),Number.isNaN(i)||i)for(i=-1;t&&i;)t=e[--s],t==="{"?++i:t==="}"&&--i}else if(t==="!"){for(i=1;e[++s]==="!";)i++;for(t=e[--s];t&&i;)t=e[++s],t==="{"?++i:t==="}"&&--i}else t==="#"?(i=a.pop(),a.push(await a.at(-1).reduce(async(c,N)=>[...await c,await o([a.concat([N,i])],y,l,{dead_loop_check:f})],[]))):t===","?(i=a.pop(),a.push(a.at(-1).slice(i)[0])):t===";"?(i=a.pop(),r=a.pop(),[void 0,+a.at(-1).length].includes(r)||Number.isNaN(r)?a.at(-1).push(i):(r=+r||0,r<0&&(r+=a.at(-1).length),r>=0&&a.at(-1).fill(i,r,r+1))):t==="$"&&(i=a.pop(),a.at(-1).splice(i,1));i=void 0,r=void 0}return a.at(-1)};export{d as default_var_dict,m as eval_what,o as exec_what,p as formatting,b as need_fstack,w as need_svo,v as run_what};
//# sourceMappingURL=whatlang_interpreter.js.map
